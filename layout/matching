import pandas as pd

# Step 1: Build a list of all matches
matches = []

for _, row2 in df2.iterrows():
    for _, row1 in df1.iterrows():
        if pd.notnull(row2['reasoncodeid']) and row1['key'] in row2['reasoncodeid']:
            matches.append({
                **row2.to_dict(),
                'matched_key': row1['key'],
                'highlevelcode': row1['highlevelcode']
            })

# Step 2: Create a new DataFrame from matches
df_matched = pd.DataFrame(matches)
